<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vibe List</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    #infoModal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(30,30,30,0.95);
      color: #fff;
      padding: 20px;
      border-radius: 12px;
      max-width: 400px;
      display: none;
      z-index: 1000;
      box-shadow: 0 0 15px rgba(0,0,0,0.5);
    }
    #infoModal button {
      margin-top: 12px;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #4db8ff;
      color: #fff;
      font-weight: 600;
    }
    #overlay {
      position: fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background: rgba(0,0,0,0.5);
      display:none;
      z-index:999;
    }
    input.edit-title {
      font-size: 20px;
      font-weight: 600;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 2px 4px;
      box-sizing: border-box;
      background:#fff;
      color:#000;
    }
    button.sub-delete {
      background: #cc6666;
      border: none;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
      padding: 0 4px;
      margin-left: 6px;
      flex-shrink: 0;
    }
    button.sub-delete:hover {
      background:#ff4d4d;
    }
  </style>
</head>
<body style="
  font-family: 'Poppins', sans-serif;
  background:#1e1e1e;
  color:#fff;
  padding:24px;
  margin:0;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  min-height:100vh;
">

  <div style="width:100%; max-width:1600px; position:relative;">
    <div style="display:flex; gap:10px; align-items:center; margin-bottom:24px;">
      <input id='taskInput' type='text' placeholder='Enter task...'
        style='flex:1; padding:12px 14px; font-size:16px; border:1px solid #444;
               border-radius:8px; background:#2b2b2b; color:#fff;
               outline:none; transition:border 0.2s ease;'
        onfocus="this.style.border='1px solid #666'" 
        onblur="this.style.border='1px solid #444'" />

      <button id='addBtn'
        style='width:46px; height:46px; font-size:22px; border:1px solid #555; border-radius:50%;
               background:#4db8ff; color:#fff; cursor:pointer; font-weight:600;
               transition:all 0.25s ease;
               display:flex; align-items:center; justify-content:center;'>
        ➕
      </button>

      <button id="infoBtn" 
        style='width:46px; height:46px; font-size:18px; border:1px solid #555; border-radius:50%;
               background:#888; color:#fff; cursor:pointer; font-weight:600;
               transition:all 0.25s ease;
               display:flex; align-items:center; justify-content:center;'>
        ℹ
      </button>
    </div>

    <div id='tasksWrap' 
      style='display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 300px)); gap:16px;'>
    </div>
  </div>

  <div id="overlay"></div>
  <div id="infoModal">
    <h3>How it works</h3>
    <p>
      - Click "➕" or press Enter to add a new task.<br>
      - Long press a task box to expand/collapse it.<br>
      - Click task box (small mode) to cycle colors.<br>
      - Add sub-tasks in extended mode. Click sub-task to mark complete (line-through).<br>
      - Click "X" to delete a task.<br>
      - In extended mode, use ⚙ button to show/hide sub-task delete buttons and edit task title.
    </p>
    <button id="closeInfo">Close</button>
  </div>

  <script>
    const input = document.getElementById('taskInput');
    const addBtn = document.getElementById('addBtn');
    const wrap = document.getElementById('tasksWrap');

    const infoBtn = document.getElementById('infoBtn');
    const infoModal = document.getElementById('infoModal');
    const overlay = document.getElementById('overlay');
    const closeInfo = document.getElementById('closeInfo');

    addBtn.addEventListener('mouseenter', () => addBtn.style.background = '#3590d1');
    addBtn.addEventListener('mouseleave', () => addBtn.style.background = '#4db8ff');
    infoBtn.addEventListener('mouseenter', () => infoBtn.style.background='#666');
    infoBtn.addEventListener('mouseleave', () => infoBtn.style.background='#888');
    infoBtn.addEventListener('click', ()=>{
      infoModal.style.display='block';
      overlay.style.display='block';
    });
    closeInfo.addEventListener('click', ()=>{
      infoModal.style.display='none';
      overlay.style.display='none';
    });
    overlay.addEventListener('click', ()=>{
      infoModal.style.display='none';
      overlay.style.display='none';
    });

    function saveTasks() {
      const tasks = [];
      wrap.querySelectorAll('div[data-mode]').forEach(box => {
        const titleEl = box.querySelector('span.task-title') || box.querySelector('div');
        const title = titleEl.textContent;
        const clicks = box.getAttribute('data-clicks');
        const subTasks = Array.from(box.querySelectorAll('div.sub-task')).map(d=>({
          text: d.querySelector('span')?.textContent || d.textContent,
          completed: d.querySelector('span')?.style.textDecoration === 'line-through'
        }));
        const mode = box.getAttribute('data-mode');
        tasks.push({title, clicks, subTasks, mode});
      });
      localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    function loadTasks() {
      const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
      tasks.forEach(t => createTask(t.title, t.clicks, t.subTasks, t.mode));
    }

    function createTask(text, clicks=0, subTasks=[], mode='small') {
      const trimmed = text.trim();
      if(!trimmed) return;

      const box = document.createElement('div');
      box.setAttribute('data-clicks', clicks);
      box.setAttribute('data-mode', mode);
      box.style.minHeight = (mode==='small') ? '60px' : '150px';
      box.style.padding='12px';
      box.style.display='flex';
      box.style.flexDirection='column';
      box.style.alignItems = (mode==='small') ? 'center':'flex-start';
      box.style.justifyContent = (mode==='small') ? 'center':'flex-start';
      box.style.fontSize='20px';
      box.style.fontWeight='600';
      box.style.borderRadius='12px';
      box.style.border='1px solid rgba(255,255,255,0.15)';
      box.style.background='rgba(255,255,255,0.08)';
      box.style.backdropFilter='blur(6px)';
      box.style.cursor='pointer';
      box.style.transition='all 0.25s ease';
      box.style.position='relative';
      box.style.textAlign='center';
      box.style.overflow='hidden';
      box.style.wordWrap = 'break-word';
      box.style.overflowWrap = 'break-word';

      const titleDiv = document.createElement('div');
      titleDiv.textContent = trimmed;
      titleDiv.style.wordWrap = 'break-word';
      titleDiv.style.overflowWrap = 'break-word';
      titleDiv.style.width = '100%';
      box.appendChild(titleDiv);

      const subList = document.createElement('div');
      subList.style.marginTop='8px';
      subList.style.display = (mode==='small')?'none':'flex';
      subList.style.flexDirection='column';
      subList.style.gap='4px';
      subList.style.width='100%';
      box.appendChild(subList);

      const subInput = document.createElement('input');
      subInput.type='text';
      subInput.placeholder='Add sub-task...';
      subInput.style.padding='4px 6px';
      subInput.style.fontSize='14px';
      subInput.style.borderRadius='6px';
      subInput.style.border='1px solid rgba(255,255,255,0.2)';
      subInput.style.background='rgba(255,255,255,0.1)';
      subInput.style.color='#fff';
      subInput.style.width='100%';
      subInput.style.boxSizing='border-box';
      subInput.style.marginTop='6px';
      subInput.style.display = (mode==='small')?'none':'block';
      box.appendChild(subInput);

      const deleteBtn = document.createElement('div');
      deleteBtn.textContent = 'X';
      deleteBtn.style.position='absolute';
      deleteBtn.style.bottom='6px';
      deleteBtn.style.right='6px';
      deleteBtn.style.fontSize='12px';
      deleteBtn.style.padding='3px 8px';
      deleteBtn.style.borderRadius='6px';
      deleteBtn.style.background='#cc6666';
      deleteBtn.style.color='#fff';
      deleteBtn.style.cursor='pointer';
      deleteBtn.style.transition='all 0.2s ease';
      deleteBtn.style.opacity = (mode==='small')?'0':'1';
      deleteBtn.addEventListener('mouseenter', ()=>deleteBtn.style.background='#ff4d4d');
      deleteBtn.addEventListener('mouseleave', ()=>deleteBtn.style.background='#cc6666');
      deleteBtn.onclick = (e)=>{ 
        e.stopPropagation();
        if(box.dataset.mode === 'extended') {
          box.remove(); 
          saveTasks(); 
        }
      };
      box.appendChild(deleteBtn);

      let settingsBtn = document.createElement('div');
      settingsBtn.textContent = '⚙';
      settingsBtn.style.position='absolute';
      settingsBtn.style.left='6px';
      settingsBtn.style.bottom='6px';
      settingsBtn.style.fontSize='14px';
      settingsBtn.style.padding='3px 6px';
      settingsBtn.style.borderRadius='6px';
      settingsBtn.style.background='#888';
      settingsBtn.style.color='#fff';
      settingsBtn.style.cursor='pointer';
      settingsBtn.style.userSelect='none';
      settingsBtn.style.display = (mode==='extended')?'flex':'none';
      box.appendChild(settingsBtn);

      let showSettings=false;

      settingsBtn.addEventListener('click', (e)=>{
        e.stopPropagation();
        showSettings = !showSettings;

        if(showSettings){
          // Remove any existing edit button first
          let existingEditBtn = titleDiv.querySelector('.edit-btn');
          if(existingEditBtn) existingEditBtn.remove();
          
          let editBtn = document.createElement('span');
          editBtn.textContent=' 🖉';
          editBtn.style.cursor='pointer';
          editBtn.classList.add('edit-btn');
          titleDiv.appendChild(editBtn);

          editBtn.onclick = (ev)=>{
            ev.stopPropagation();
            const inputEdit = document.createElement('input');
            inputEdit.type='text';
            inputEdit.value=titleDiv.textContent.replace(' 🖉','');
            inputEdit.className='edit-title';
            titleDiv.textContent='';
            titleDiv.appendChild(inputEdit);
            inputEdit.focus();
            inputEdit.addEventListener('keydown', e=>{
              if(e.key==='Enter'){
                titleDiv.textContent = inputEdit.value;
                titleDiv.appendChild(editBtn);
                saveTasks();
              }
            });
          };

          subList.querySelectorAll('div').forEach(sub=>{
            if(!sub.querySelector('button')){
              sub.style.display='flex';
              sub.style.justifyContent='space-between';
              sub.style.alignItems='flex-start';
              sub.style.flexWrap='wrap';
              let btn = document.createElement('button');
              btn.textContent='X';
              btn.className='sub-delete';
              btn.addEventListener('click', ev=>{
                ev.stopPropagation();
                sub.remove();
                saveTasks();
              });
              sub.appendChild(btn);
            }
          });
        } else {
          subList.querySelectorAll('div button.sub-delete').forEach(b=>b.remove());
          let editBtn = titleDiv.querySelector('.edit-btn');
          if(editBtn) editBtn.remove();
        }
      });

      // Load sub-tasks
      subTasks.forEach(st=>{
        const sub = document.createElement('div');
        sub.classList.add('sub-task');
        sub.style.display='flex';
        sub.style.justifyContent='space-between';
        sub.style.alignItems='flex-start';
        sub.style.flexWrap='wrap';
        const span = document.createElement('span');
        span.textContent = st.text;
        span.style.wordWrap = 'break-word';
        span.style.overflowWrap = 'break-word';
        span.style.flex = '1';
        span.style.minWidth = '0';
        sub.appendChild(span);
        sub.style.fontSize='14px';
        sub.style.background='rgba(255,255,255,0.15)';
        sub.style.padding='2px 6px';
        sub.style.borderRadius='6px';
        sub.style.cursor='pointer';
        sub.style.color = st.completed ? 'rgba(255,255,255,0.8)' : '#000';
        sub.style.textDecoration = st.completed ? 'line-through':'none';
        sub.style.textAlign='left';
        span.addEventListener('click', ()=>{
          if(span.style.textDecoration==='line-through'){
            span.style.textDecoration='none';
            span.style.color='#000';
          } else {
            span.style.textDecoration='line-through';
            span.style.color='rgba(255,255,255,0.8)';
          }
          saveTasks();
        });
        subList.appendChild(sub);
      });

      // Small mode color cycle
      box.addEventListener('click', (e)=>{
        if([deleteBtn, subInput, settingsBtn].includes(e.target)) return;
        if(box.dataset.mode==='small'){
          let c = parseInt(box.getAttribute('data-clicks')||'0',10);
          c = (c+1)%3;
          box.setAttribute('data-clicks',c);
          if(c===1){
            box.style.background='rgba(255,210,120,0.6)';
            box.style.color='#000';
          } else if(c===2){
            box.style.background='rgba(90,255,180,0.6)';
            box.style.color='#000';
          } else {
            box.style.background='rgba(255,255,255,0.08)';
            box.style.color='#fff';
          }
          saveTasks();
        }
      });

      // Long press toggle extended
      let holdTimer;
      box.addEventListener('mousedown', ()=>{
        holdTimer = setTimeout(()=>{
          if(box.dataset.mode==='small'){
            box.dataset.mode='extended';
            box.style.minHeight='150px';
            box.style.justifyContent='flex-start';
            box.style.paddingBottom='50px';
            subList.style.display='flex';
            subInput.style.display='block';
            deleteBtn.style.opacity='1';
            settingsBtn.style.display='flex';
          } else {
            box.dataset.mode='small';
            box.style.minHeight='60px';
            box.style.justifyContent='center';
            box.style.paddingBottom='12px';
            subList.style.display='none';
            subInput.style.display='none';
            deleteBtn.style.opacity='0';
            settingsBtn.style.display='none';
            // Clean up settings mode elements
            showSettings = false;
            subList.querySelectorAll('div button.sub-delete').forEach(b=>b.remove());
            let editBtn = titleDiv.querySelector('.edit-btn');
            if(editBtn) editBtn.remove();
          }
          saveTasks();
        },700);
      });
      box.addEventListener('mouseup', ()=>clearTimeout(holdTimer));
      box.addEventListener('mouseleave', ()=>clearTimeout(holdTimer));

      subInput.addEventListener('keydown', e=>{
        if(e.key==='Enter'){
          const text = subInput.value.trim();
          if(!text) return;
          const sub = document.createElement('div');
          sub.classList.add('sub-task');
          sub.style.display='flex';
          sub.style.justifyContent='space-between';
          sub.style.alignItems='flex-start';
          sub.style.flexWrap='wrap';
          const span = document.createElement('span');
          span.textContent = text;
          span.style.wordWrap = 'break-word';
          span.style.overflowWrap = 'break-word';
          span.style.flex = '1';
          span.style.minWidth = '0';
          sub.appendChild(span);
          sub.style.fontSize='14px';
          sub.style.background='rgba(255,255,255,0.15)';
          sub.style.padding='2px 6px';
          sub.style.borderRadius='6px';
          sub.style.cursor='pointer';
          sub.style.color='#000';
          sub.style.textDecoration='none';
          sub.style.textAlign='left';
          span.addEventListener('click', ()=>{
            if(span.style.textDecoration==='line-through'){
              span.style.textDecoration='none';
              span.style.color='#000';
            } else {
              span.style.textDecoration='line-through';
              span.style.color='rgba(255,255,255,0.8)';
            }
            saveTasks();
          });
          subList.appendChild(sub);
          subInput.value='';
          saveTasks();
        }
      });

      wrap.appendChild(box);
      input.value='';
      input.focus();
      saveTasks();
    }

    addBtn.onclick = ()=>createTask(input.value);
    input.addEventListener('keydown', e=>{ if(e.key==='Enter') createTask(input.value); });

    loadTasks();
  </script>
</body>
</html>
